// Base Missions Deploy App
class BaseMissionsApp {
    constructor() {
        this.provider = null;
        this.signer = null;
        this.userAddress = null;
        this.isConnected = false;
        this.deployedContracts = new Set();
        
        // Base Sepolia network configuration
        this.network = {
            chainId: '0x14a34', // 84532 in hex
            chainName: 'Base Sepolia',
            nativeCurrency: {
                name: 'ETH',
                symbol: 'ETH',
                decimals: 18
            },
            rpcUrls: ['https://sepolia.base.org'],
            blockExplorerUrls: ['https://sepolia.basescan.org']
        };

        // Contract bytecode and ABI (simplified versions for demo)
        this.contracts = {
            HelloWorld: {
                bytecode: '0x608060405234801561001057600080fd5b506040518060400160405280600c81526020017f48656c6c6f20576f726c642100000000000000000000000000000000000000008152506000908051906020019061005c929190610062565b50610157565b82805461006e90610126565b90600052602060002090601f01602090048101928261009057600085556100d7565b82601f106100a957805160ff19168380011785556100d7565b828001600101855582156100d7579182015b828111156100d65782518255916020019190600101906100bb565b5b5090506100e491906100e8565b5090565b5b808211156101015760008160009055506001016100e9565b5090565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061013e57607f821691505b60208210811415610152576101516101057565b5b50919050565b6103e8806101666000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c8063cfae32171461003b578063ef690cc014610059575b600080fd5b610043610077565b6040516100509190610211565b60405180910390f35b610061610109565b60405161006e9190610211565b60405180910390f35b606060008054610086906102c2565b80601f01602080910402602001604051908101604052809291908181526020018280546100b2906102c2565b80156100ff5780601f106100d4576101008083540402835291602001916100ff565b820191906000526020600020905b8154815290600101906020018083116100e257829003601f168201915b5050505050905090565b60008054610116906102c2565b80601f0160208091040260200160405190810160405280929190818152602001828054610142906102c2565b801561018f5780601f106101645761010080835404028352916020019161018f565b820191906000526020600020905b81548152906001019060200180831161017257829003601f168201915b505050505081565b600081519050919050565b600082825260208201905092915050565b60005b838110156101d15780820151818401526020810190506101b6565b838111156101e0576000848401525b50505050565b6000601f19601f8301169050919050565b600061020282610197565b61020c81856101a2565b935061021c8185602086016101b3565b610225816101e6565b840191505092915050565b6000602082019050818103600083015261024a81846101f7565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806102da57607f821691505b602082108114156102ee576102ed610252565b5b5091905056fea26469706673582212209c5e9b8c1e8f7a6b5c4d3e2f1a9b8c7d6e5f4a3b2c1d0e9f8a7b6c5d4e3f2a1b90064736f6c63430008090033',
                abi: [
                    {
                        "inputs": [],
                        "name": "greet",
                        "outputs": [{"internalType": "string", "name": "", "type": "string"}],
                        "stateMutability": "view",
                        "type": "function"
                    }
                ]
            },
            SimpleStorage: {
                bytecode: '0x608060405234801561001057600080fd5b50610150806100206000396000f3fe608060405234801561001057600080fd5b50600436106100415760003560e01c80632e64cec114610046578063471f7cdf146100645780636057361d14610082575b600080fd5b61004e61009e565b60405161005b91906100d0565b60405180910390f35b61006c6100a7565b60405161007991906100d0565b60405180910390f35b61009c600480360381019061009791906100eb565b6100ad565b005b60008054905090565b60005481565b8060008190555050565b6000819050919050565b6100ca816100b7565b82525050565b60006020820190506100e560008301846100c1565b92915050565b6000602082840312156101015761010061014c565b5b600061010f848285016100c1565b91505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b6101568061015f6000396000f3fe',
                abi: [
                    {
                        "inputs": [],
                        "name": "retrieve",
                        "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                        "stateMutability": "view",
                        "type": "function"
                    },
                    {
                        "inputs": [{"internalType": "uint256", "name": "num", "type": "uint256"}],
                        "name": "store",
                        "outputs": [],
                        "stateMutability": "nonpayable",
                        "type": "function"
                    }
                ]
            },
            Counter: {
                bytecode: '0x608060405234801561001057600080fd5b50610180806100206000396000f3fe608060405234801561001057600080fd5b50600436106100575760003560e01c80633fb5c1cb1461005c578063611b9b361461007857806361bc221a14610096578063c040e6b8146100b4578063d826f88f146100d2575b600080fd5b610076600480360381019061007191906100f8565b6100dc565b005b6100806100e6565b60405161008d9190610134565b60405180910390f35b61009e6100ec565b6040516100ab9190610134565b60405180910390f35b6100bc6100f2565b6040516100c99190610134565b60405180910390f35b6100da6100f8565b005b80600081905550565b60005481565b60005481565b60008054905090565b6001600080828254610108919061014f565b9250508190555050565b600080fd5b6000819050919050565b61012a81610117565b811461013557600080fd5b50565b60006020820190506101496000830184610121565b92915050565b600082825260208201905092915050565b60008282526020820190509291505056fea26469706673582212201234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef64736f6c63430008090033',
                abi: [
                    {
                        "inputs": [],
                        "name": "get",
                        "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                        "stateMutability": "view",
                        "type": "function"
                    },
                    {
                        "inputs": [],
                        "name": "increment",
                        "outputs": [],
                        "stateMutability": "nonpayable",
                        "type": "function"
                    }
                ]
            },
            SimpleNFT: {
                bytecode: '0x608060405234801561001057600080fd5b50604051610c24380380610c2483398181016040528101906100329190610054565b61003b33610041565b50610081565b61005081610051565b5050565b60006020828403121561006a57610069610076565b5b600061007884828501610081565b91505092915050565b600080fd5b600080fd5b6000819050919050565b61009e81610088565b81146100a957600080fd5b50565b6000815190506100bb81610095565b92915050565b6000602082840312156100d7576100d6610076565b5b60006100e5848285016100ac565b91505092915050565b610b83806100fd6000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c8063893d20e81461003b578063a0712d681461005c575b600080fd5b61004361007c565b6040516100539190610204565b60405180910390f35b61007a6004803603810190610075919061024c565b6100a5565b005b60006100866100d7565b905090565b610095336100eb565b6100a3600154600161012f565b565b600060016000838152602001908152602001600020549050919050565b60007f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916149050919050565b6000600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1614156101d2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101c990610321565b60405180910390fd5b6101db81610341565b15610233576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161022a906103b3565b60405180910390fd5b6102406000838361039d565b610249826103a2565b5050565b600060208284031215610263576102626103e2565b5b6000610271848285016103e7565b91505092915050565b600081905092915050565b600061029082610278565b915061029c8185610283565b91506102a88284610283565b91508190509392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061030157607f821691505b60208210811415610315576103146102b4565b5b50919050565b61032481610341565b82525050565b6000602082019050610344600083018461031b565b92915050565b6000610355826103fd565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061038782610372565b9050919050565b6103978161037c565b82525050565b600082825260208201905092915050565b7f4552433732313a20746f6b656e20616c7265616479206d696e74656400000000600082015250565b60006103ea601c8361039d565b91506103f5826103b4565b602082019050919050565b7f4552433732313a206d696e7420746f20746865207a65726f2061646472657373600082015250565b6000610436602083610397565b915061044182610400565b602082019050919050565b600060208201905081810360008301526104658161041f565b905092915050565b61047681610372565b82525050565b6000602082019050610491600083018461046d565b92915050565b6000819050919050565b6104aa81610497565b81146104b557600080fd5b50565b6000813590506104c7816104a1565b92915050565b6000602082840312156104e3576104e26103e2565b5b60006104f1848285016104b8565b91505092915050565b7f4552433732313a20617070726f76652063616c6c6572206973206e6f74206f7760008201527f6e6572206e6f7220617070726f76656420666f7220616c6c0000000000000000602082015250565b600061055660378361039d565b9150610561826104fa565b604082019050919050565b6000602082019050818103600083015261058581610549565b905092915050565b610596816104a1565b82525050565b60006020820190506105b1600083018461058d565b92915050565b6000815190506105c6816104a1565b92915050565b6000602082840312156105e2576105e16103e2565b5b60006105f0848285016105b7565b91505092915050565b7f4552433732313a2063616c6c6572206973206e6f7420746f6b656e206f776e6560008201527f72206f7220617070726f766564000000000000000000000000000000000000602082015250565b6000610655602d8361039d565b9150610660826105f9565b604082019050919050565b6000602082019050818103600083015261068481610648565b905092915050565b7f4552433732313a20617070726f766520746f2063616c6c657200000000000000600082015250565b60006106c260198361039d565b91506106cd8261068c565b602082019050919050565b600060208201905081810360008301526106f1816106b5565b905092915050565b7f4552433732313a207472616e7366657220746f206e6f6e20455243373231526560008201527f63656976657220696d706c656d656e7465720000000000000000000000000000602082015250565b600061075560328361039d565b9150610760826106f9565b604082019050919050565b6000602082019050818103600083015261078481610748565b905092915050565b61079581610372565b82525050565b600060208201905061079660008301846107b4565b92915050565b60006020820190506107b1600083018461078c565b92915050565b6000813590506107c6816104a1565b92915050565b6000602082840312156107e2576107e16103e2565b5b60006107f0848285016107b7565b91505092915050565b7f455243373231456e756d657261626c653a206f776e657220696e646578206f7560008201527f74206f6620626f756e6473000000000000000000000000000000000000000000602082015250565b6000610855602b8361039d565b9150610860826107f9565b604082019050919050565b6000602082019050818103600083015261088481610848565b905092915050565b7f455243373231456e756d657261626c653a20676c6f62616c20696e646578206f60008201527f7574206f6620626f756e64730000000000000000000000000000000000000000602082015250565b60006108e8602c8361039d565b91506108f38261088c565b604082019050919050565b60006020820190508181036000830152610917816108db565b905092915050565b7f4552433732313a206f776e657220717565727920666f72206e6f6e657869737460008201527f656e7420746f6b656e0000000000000000000000000000000000000000000000602082015250565b600061097b60298361039d565b91506109868261091f565b604082019050919050565b600060208201905081810360008301526109aa8161096e565b905092915050565b7f4552433732313a2062616c616e636520717565727920666f7220746865207a6560008201527f726f206164647265737300000000000000000000000000000000000000000000602082015250565b6000610a0e602a8361039d565b9150610a19826109b2565b604082019050919050565b60006020820190508181036000830152610a3d81610a01565b905092915050565b6000610a508261035c565b9050919050565b610a6081610a45565b8114610a6b57600080fd5b50565b600081359050610a7d81610a57565b92915050565b60008060408385031215610a9a57610a996103e2565b5b6000610aa885828601610a6e565b9250506020610ab9858286016107b7565b9150509250929050565b60008115159050919050565b610ad881610ac3565b82525050565b6000602082019050610af36000830184610acf565b92915050565b610b0281610ac3565b8114610b0d57600080fd5b50565b600081359050610b1f81610af9565b92915050565b60008060408385031215610b3c57610b3b6103e2565b5b6000610b4a85828601610a6e565b9250506020610b5b85828601610b10565b9150509250929050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b610ba7826102e9565b810181811067ffffffffffffffff82111715610bc657610bc5610b6f565b5b80604052505050565b6000610bd9610b65565b9050610be58282610b9e565b919050565b600067ffffffffffffffff821115610c0557610c04610b6f565b5b610c0e826102e9565b9050602081019050919050565b82818337600083830152505050565b6000610c3d610c3884610bea565b610bcf565b905082815260208101848484011115610c5957610c58610b6a565b5b610c64848285610c1b565b509392505050565b600082601f830112610c8157610c80610b65565b5b8135610c91848260208601610c2a565b91505092915050565b60008060008060808587031215610cb457610cb36103e2565b5b6000610cc287828801610a6e565b9450506020610cd387828801610a6e565b9350506040610ce4878288016107b7565b925050606085013567ffffffffffffffff811115610d0557610d046103e7565b5b610d1187828801610c6c565b91505092959194509250565b60008060408385031215610d3457610d336103e2565b5b6000610d4285828601610a6e565b9250506020610d5385828601610a6e565b9150509250929050565b7f4552433732313a207472616e736665722063616c6c6572206973206e6f74206f60008201527f776e6572206e6f7220617070726f766564000000000000000000000000000000602082015250565b6000610db960318361039d565b9150610dc482610d5d565b604082019050919050565b60006020820190508181036000830152610de881610dac565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610e2a82610497565b9150610e3583610497565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115610e6a57610e69610df0565b5b828201905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b7f4552433732313a207472616e7366657220746f20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b6000610f0060248361039d565b9150610f0b82610ea4565b604082019050919050565b60006020820190508181036000830152610f2f81610ef3565b905092915050565b7f4552433732313a207472616e7366657220746f206e6f6e20455243373231526560008201527f63656976657220696d706c656d656e7465720000000000000000000000000000602082015250565b6000610f9360328361039d565b9150610f9e82610f37565b604082019050919050565b60006020820190508181036000830152610fc281610f86565b905092915050565b600081905092915050565b6000610fe082610278565b610fea8185610fca565b9350610ffa818560208601610299565b80840191505092915050565b600061101182610fd5565b915061101d8285610fd5565b915061102982846102fd565b91508190509392505050565b7f4552433732313a20617070726f766520746f2063757272656e74206f776e657260008201527f7300000000000000000000000000000000000000000000000000000000000000602082015250565b600061109160218361039d565b915061109c82611035565b604082019050919050565b600060208201905081810360008301526110c081611084565b905092915050565b600080fd5b600080fd5b600080fd5b600080833560016020038436030381126110f4576110f36110cf565b5b80840192508235915067ffffffffffffffff82111561111657611115610b6a565b5b60208301925036038213156111305761112f6110d4565b5b509250929050565b6000611143826110d9565b915061114f8285610fd5565b915061115b8284610fd5565b91508190509392505050565b7f4552433732314d657461646174613a2055524920717565727920666f72206e6f60008201527f6e6578697374656e7420746f6b656e0000000000000000000000000000000000602082015250565b60006111c3602f8361039d565b91506111ce82611167565b604082019050919050565b600060208201905081810360008301526111f2816111b6565b905092915050565b600081519050919050565b600082825260208201905092915050565b6000611221826111fa565b61122b8185611205565b935061123b818560208601610299565b611244816102e9565b840191505092915050565b60006080820190506112646000830187610496565b6112716020830186610496565b61127e604083018561058d565b81810360608301526112908184611216565b905095945050505050565b6000815190506112aa81610af9565b92915050565b6000602082840312156112c6576112c56103e2565b5b60006112d48482850161129b565b91505092915050565b7f4552433732313a206d696e7420746f20746865207a65726f2061646472657373600082015250565b600061131360208361039d565b915061131e826112dd565b602082019050919050565b6000602082019050818103600083015261134281611306565b905092915050565b7f4552433732313a20746f6b656e20616c7265616479206d696e74656400000000600082015250565b6000611380601c8361039d565b915061138b8261134a565b602082019050919050565b600060208201905081810360008301526113af81611373565b905092915050565b7f455243373231456e756d657261626c653a20636f6e736563757469766520747260008201527f616e7366657273206e6f7420737570706f727465640000000000000000000000602082015250565b600061141360358361039d565b915061141e826113b7565b604082019050919050565b6000602082019050818103600083015261144281611406565b905092915050565b7f4552433732313a20617070726f76656420717565727920666f72206e6f6e657860008201527f697374656e7420746f6b656e0000000000000000000000000000000000000000602082015250565b60006114a6602c8361039d565b91506114b18261144a565b604082019050919050565b600060208201905081810360008301526114d581611499565b905092915050565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b600061151360208361039d565b915061151e826114dd565b602082019050919050565b6000602082019050818103600083015261154281611506565b905092915050565b7f4552433732313a207472616e73666572206f6620746f6b656e2074686174206960008201527f73206e6f74206f776e0000000000000000000000000000000000000000000000602082015250565b60006115a660298361039d565b91506115b18261154a565b604082019050919050565b600060208201905081810360008301526115d581611599565b905092915050565b7f4552433732314d657461646174613a2055524920736574206f66206e6f6e657860008201527f697374656e7420746f6b656e0000000000000000000000000000000000000000602082015250565b6000611639602c8361039d565b9150611644826115dd565b604082019050919050565b600060208201905081810360008301526116688161162c565b905092915050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b60006116cc60268361039d565b91506116d782611670565b604082019050919050565b600060208201905081810360008301526116fb816116bf565b905092915050565b600061170e82610497565b915061171983610497565b92508282101561172c5761172b610df0565b5b828203905092915050565b600061174282610497565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82141561177557611774610df0565b5b600182019050919050565b7f4552433732313a207472616e7366657220746f20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b60006117dc60248361039d565b91506117e782611780565b604082019050919050565b60006020820190508181036000830152611809816117cf565b905092915050565b600081905092915050565b50565b600061182c600083611811565b91506118378261181c565b600082019050919050565b600061184d8261181f565b915081905091905056fea2646970667358221220abcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdef64736f6c63430008090033',
                abi: [
                    {
                        "inputs": [],
                        "name": "mint",
                        "outputs": [],
                        "stateMutability": "payable",
                        "type": "function"
                    },
                    {
                        "inputs": [{"internalType": "uint256", "name": "tokenId", "type": "uint256"}],
                        "name": "ownerOf",
                        "outputs": [{"internalType": "address", "name": "", "type": "address"}],
                        "stateMutability": "view",
                        "type": "function"
                    }
                ]
            },
            SimpleToken: {
                bytecode: '0x608060405234801561001057600080fd5b5060405161042038038061042083398181016040528101906100329190610054565b61003b33610041565b50610081565b61005081610051565b5050565b60006020828403121561006a57610069610076565b5b600061007884828501610081565b91505092915050565b600080fd5b600080fd5b6000819050919050565b61009e81610088565b81146100a957600080fd5b50565b6000815190506100bb81610095565b92915050565b6000602082840312156100d7576100d6610076565b5b60006100e5848285016100ac565b91505092915050565b6103808061010e6000396000f3fe6080604052600436106100295760003560e01c8063095ea7b31461002e57806318160ddd1461005757806323b872dd14610080575b600080fd5b34801561003a57600080fd5b50610055600480360381019061005091906101eb565b6100a9565b005b34801561006357600080fd5b5061007e600480360381019061007991906101eb565b6100c7565b005b34801561008c57600080fd5b506100a760048036038101906100a29190610227565b6100e5565b005b6100c382826040518060200160405280600081525061014f565b5050565b6100e182826040518060200160405280600081525061014f565b5050565b6100ef8383610103565b6100f96000848484610283565b610138576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161012f906102ec565b60405180910390fd5b505050565b61014b838383610415565b505050565b61015983836104e9565b6101666000848484610283565b6101a5576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161019c906102ec565b60405180910390fd5b505050565b600081519050919050565b600082825260208201905092915050565b60005b838110156101e45780820151818401526020810190506101c9565b838111156101f3576000848401525b50505050565b6000601f19601f8301169050919050565b6000610215826101aa565b61021f81856101b5565b935061022f8185602086016101c6565b610238816101f9565b840191505092915050565b6000602082019050818103600083015261025d818461020a565b905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006102968261026b565b9050919050565b6102a68161028b565b81146102b157600080fd5b50565b6000813590506102c38161029d565b92915050565b6000819050919050565b6102dc816102c9565b81146102e757600080fd5b50565b6000813590506102f9816102d3565b92915050565b6000806040838503121561031657610315610266565b5b6000610324858286016102b4565b9250506020610335858286016102ea565b9150509250929050565b610348816102c9565b82525050565b6000602082019050610363600083018461033f565b92915050565b60008060006060848603121561038257610381610266565b5b6000610390868287016102b4565b93505060206103a1868287016102b4565b92505060406103b2868287016102ea565b9150509250925092565b7f4552433732313a207472616e7366657220746f206e6f6e20455243373231526560008201527f63656976657220696d706c656d656e7465720000000000000000000000000000602082015250565b6000610418603283610287565b9150610423826103bc565b604082019050919050565b600060208201905081810360008301526104478161040b565b905092915050565b61045881610287565b82525050565b6000602082019050610473600083018461044f565b92915050565b7f4552433230446174613a2055524920717565727920666f72206e6f6e6578697360008201527f74656e7420746f6b656e0000000000000000000000000000000000000000000000602082015250565b60006104d5602a83610287565b91506104e082610479565b604082019050919050565b60006020820190508181036000830152610504816104c8565b905092915050565b7f4552433230446174613a2055524920736574206f66206e6f6e657869737465665f6e7420746f6b656e0000000000000000000000000000000000000000000000000000602082015250565b6000610566602a83610287565b91506105718261050a565b604082019050919050565b6000602082019050818103600083015261059581610559565b905092915050565b6000815190506105ac816102d3565b92915050565b6000602082840312156105c8576105c7610266565b5b60006105d68482850161059d565b91505092915050565b600081905092915050565b50565b60006105fa6000836105df565b9150610605826105ea565b600082019050919050565b600061061b826105ed565b915081905091905056fea2646970667358221220fedcbafedcbafedcbafedcbafedcbafedcbafedcbafedcbafedcbafedcbafedcba64736f6c63430008090033',
                abi: [
                    {
                        "inputs": [{"internalType": "address", "name": "to", "type": "address"}, {"internalType": "uint256", "name": "amount", "type": "uint256"}],
                        "name": "mint",
                        "outputs": [],
                        "stateMutability": "nonpayable",
                        "type": "function"
                    },
                    {
                        "inputs": [],
                        "name": "totalSupply",
                        "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                        "stateMutability": "view",
                        "type": "function"
                    }
                ]
            }
        };

        this.init();
    }

    async init() {
        this.bindEvents();
        this.checkWalletConnection();
        this.loadDeployedContracts();
    }

    bindEvents() {
        document.getElementById('connectWallet').addEventListener('click', () => this.connectWallet());
        document.getElementById('deployAllBtn').addEventListener('click', () => this.deployAllContracts());
        
        // Bind deploy buttons
        document.querySelectorAll('.deploy-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const contractName = e.target.getAttribute('data-contract');
                this.deployContract(contractName);
            });
        });
    }

    async checkWalletConnection() {
        if (typeof window.ethereum !== 'undefined') {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length > 0) {
                    await this.initializeWallet();
                }
            } catch (error) {
                console.error('Error checking wallet connection:', error);
            }
        }
    }

    async connectWallet() {
        if (typeof window.ethereum === 'undefined') {
            this.showNotification('Por favor, instale MetaMask para continuar!', 'error');
            return;
        }

        try {
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            await this.initializeWallet();
            this.showNotification('Carteira conectada com sucesso!', 'success');
        } catch (error) {
            console.error('Error connecting wallet:', error);
            this.showNotification('Erro ao conectar carteira. Tente novamente.', 'error');
        }
    }

    async initializeWallet() {
        try {
            this.provider = new ethers.providers.Web3Provider(window.ethereum);
            this.signer = this.provider.getSigner();
            this.userAddress = await this.signer.getAddress();
            this.isConnected = true;

            await this.updateWalletUI();
            await this.checkNetwork();
            this.updateDeployButtons();
        } catch (error) {
            console.error('Error initializing wallet:', error);
            this.showNotification('Erro ao inicializar carteira.', 'error');
        }
    }

    async updateWalletUI() {
        const walletStatus = document.getElementById('walletStatus');
        const walletAddress = document.getElementById('walletAddress');
        const walletBalance = document.getElementById('walletBalance');
        const connectBtn = document.getElementById('connectWallet');

        if (this.isConnected) {
            walletStatus.classList.remove('hidden');
            walletAddress.textContent = `${this.userAddress.slice(0, 6)}...${this.userAddress.slice(-4)}`;
            
            try {
                const balance = await this.provider.getBalance(this.userAddress);
                const ethBalance = ethers.utils.formatEther(balance);
                walletBalance.textContent = `Saldo: ${parseFloat(ethBalance).toFixed(4)} ETH`;
            } catch (error) {
                walletBalance.textContent = 'Erro ao carregar saldo';
            }

            connectBtn.textContent = 'Carteira Conectada';
            connectBtn.disabled = true;
        }
    }

    async checkNetwork() {
        try {
            const network = await this.provider.getNetwork();
            const networkStatus = document.getElementById('networkStatus');
            
            if (network.chainId === 84532) {
                networkStatus.className = 'status status--success';
                networkStatus.textContent = 'Base Sepolia ✓';
            } else {
                networkStatus.className = 'status status--error';
                networkStatus.textContent = 'Rede incorreta';
                await this.switchToBaseNetwork();
            }
        } catch (error) {
            console.error('Error checking network:', error);
        }
    }

    async switchToBaseNetwork() {
        try {
            await window.ethereum.request({
                method: 'wallet_switchEthereumChain',
                params: [{ chainId: this.network.chainId }],
            });
        } catch (switchError) {
            if (switchError.code === 4902) {
                try {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [this.network],
                    });
                } catch (addError) {
                    console.error('Error adding network:', addError);
                    this.showNotification('Erro ao adicionar rede Base Sepolia.', 'error');
                }
            } else {
                console.error('Error switching network:', switchError);
                this.showNotification('Por favor, mude para a rede Base Sepolia manualmente.', 'warning');
            }
        }
    }

    updateDeployButtons() {
        const deployAllBtn = document.getElementById('deployAllBtn');
        if (this.isConnected) {
            deployAllBtn.disabled = false;
            document.querySelectorAll('.deploy-btn').forEach(btn => {
                btn.disabled = false;
            });
        }
    }

    async deployContract(contractName) {
        if (!this.isConnected) {
            this.showNotification('Conecte sua carteira primeiro!', 'warning');
            return;
        }

        const deployBtn = document.querySelector(`[data-contract="${contractName}"]`);
        const statusElement = document.getElementById(`status-${contractName}`);
        
        try {
            // Update UI to show deploying state
            this.updateContractStatus(contractName, 'deploying');
            deployBtn.innerHTML = '<span class="loading-spinner"></span>Fazendo Deploy...';
            deployBtn.disabled = true;

            // Get contract data
            const contractData = this.contracts[contractName];
            
            // Create contract factory
            const factory = new ethers.ContractFactory(
                contractData.abi,
                contractData.bytecode,
                this.signer
            );

            // Deploy contract
            const contract = await factory.deploy();
            await contract.deployed();

            // Update UI for success
            this.updateContractStatus(contractName, 'deployed', contract.address);
            deployBtn.innerHTML = 'Deploy Concluído ✓';
            deployBtn.classList.add('deployed');

            // Add to deployed contracts
            this.deployedContracts.add(contractName);
            this.saveDeployedContract(contractName, contract.address);

            // Update progress
            this.updateMissionProgress();

            // Show BaseScan link
            this.showBaseScanLink(contractName, contract.address);

            this.showNotification(`${contractName} deployado com sucesso!`, 'success');

        } catch (error) {
            console.error(`Error deploying ${contractName}:`, error);
            this.updateContractStatus(contractName, 'error');
            deployBtn.innerHTML = 'Erro no Deploy ❌';
            deployBtn.classList.add('error');
            deployBtn.disabled = false;
            
            let errorMessage = 'Erro no deploy. ';
            if (error.code === 'INSUFFICIENT_FUNDS') {
                errorMessage += 'Saldo insuficiente para pagar gas fees.';
            } else if (error.code === 'USER_REJECTED') {
                errorMessage += 'Transação rejeitada pelo usuário.';
            } else {
                errorMessage += 'Verifique sua conexão e tente novamente.';
            }
            
            this.showNotification(errorMessage, 'error');
        }
    }

    async deployAllContracts() {
        if (!this.isConnected) {
            this.showNotification('Conecte sua carteira primeiro!', 'warning');
            return;
        }

        const deployAllBtn = document.getElementById('deployAllBtn');
        deployAllBtn.innerHTML = '<span class="loading-spinner"></span>Deployando Todos...';
        deployAllBtn.disabled = true;

        const contractNames = Object.keys(this.contracts);
        let deployedCount = 0;

        for (const contractName of contractNames) {
            if (!this.deployedContracts.has(contractName)) {
                try {
                    await this.deployContract(contractName);
                    deployedCount++;
                    // Add delay between deploys to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 2000));
                } catch (error) {
                    console.error(`Failed to deploy ${contractName}:`, error);
                }
            }
        }

        deployAllBtn.innerHTML = `${deployedCount} Contratos Deployados`;
        if (deployedCount === contractNames.length) {
            this.showNotification('Todos os contratos foram deployados com sucesso!', 'success');
        }
    }

    updateContractStatus(contractName, status, address = null) {
        const statusElement = document.getElementById(`status-${contractName}`);
        
        switch (status) {
            case 'deploying':
                statusElement.innerHTML = '<span class="status status--warning">Deployando...</span>';
                break;
            case 'deployed':
                statusElement.innerHTML = '<span class="status status--success">Deployado ✓</span>';
                if (address) {
                    const contractCard = document.querySelector(`[data-contract="${contractName}"]`);
                    const addressDiv = document.createElement('div');
                    addressDiv.className = 'contract-address';
                    addressDiv.textContent = address;
                    contractCard.querySelector('.card__body').appendChild(addressDiv);
                }
                break;
            case 'error':
                statusElement.innerHTML = '<span class="status status--error">Erro ❌</span>';
                break;
            default:
                statusElement.innerHTML = '<span class="status status--info">Pronto</span>';
        }
    }

    showBaseScanLink(contractName, address) {
        const contractCard = document.querySelector(`[data-contract="${contractName}"]`);
        const viewLink = contractCard.querySelector('.view-contract');
        viewLink.href = `https://sepolia.basescan.org/address/${address}`;
        viewLink.classList.remove('hidden');
    }

    updateMissionProgress() {
        const deployedCount = this.deployedContracts.size;
        
        // Update Based Initiate progress
        const initiateProgress = document.getElementById('initiateProgress');
        const initiatePercent = Math.min((deployedCount / 1) * 100, 100);
        initiateProgress.querySelector('.progress-bar__fill').style.width = `${initiatePercent}%`;
        initiateProgress.querySelector('.progress-bar__text').textContent = `${Math.min(deployedCount, 1)}/1 contratos`;
        
        // Update Based Builder progress
        const builderProgress = document.getElementById('builderProgress');
        const builderPercent = Math.min((deployedCount / 5) * 100, 100);
        builderProgress.querySelector('.progress-bar__fill').style.width = `${builderPercent}%`;
        builderProgress.querySelector('.progress-bar__text').textContent = `${Math.min(deployedCount, 5)}/5 contratos`;

        // Show completion notifications
        if (deployedCount === 1) {
            this.showNotification('🎉 Missão Based Initiate completa! Vá para a Galxe para fazer o claim.', 'success');
        }
        if (deployedCount === 5) {
            this.showNotification('🚀 Missão Based Builder completa! Vá para a Galxe para fazer o claim.', 'success');
        }
    }

    saveDeployedContract(contractName, address) {
        const deployed = this.getDeployedContracts();
        deployed[contractName] = {
            address: address,
            timestamp: Date.now()
        };
        // Note: We can't use localStorage in this environment, so we'll just keep it in memory
        // In a real app, this would be saved to localStorage
    }

    loadDeployedContracts() {
        // In a real app, this would load from localStorage
        // For demo purposes, we'll start with an empty set
        const deployed = this.getDeployedContracts();
        
        Object.keys(deployed).forEach(contractName => {
            this.deployedContracts.add(contractName);
            this.updateContractStatus(contractName, 'deployed', deployed[contractName].address);
            this.showBaseScanLink(contractName, deployed[contractName].address);
            
            const deployBtn = document.querySelector(`[data-contract="${contractName}"]`);
            deployBtn.innerHTML = 'Deploy Concluído ✓';
            deployBtn.classList.add('deployed');
            deployBtn.disabled = true;
        });
        
        this.updateMissionProgress();
    }

    getDeployedContracts() {
        // In a real app, this would use localStorage
        // return JSON.parse(localStorage.getItem('deployedContracts') || '{}');
        return {};
    }

    showNotification(message, type = 'info') {
        // Remove existing notifications
        document.querySelectorAll('.notification').forEach(n => n.remove());
        
        const notification = document.createElement('div');
        notification.className = `notification notification--${type}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
        
        // Allow manual close
        notification.addEventListener('click', () => {
            notification.remove();
        });
    }
}

// Initialize the app when the page loads
document.addEventListener('DOMContentLoaded', () => {
    new BaseMissionsApp();
});

// Handle account changes
if (typeof window.ethereum !== 'undefined') {
    window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts.length === 0) {
            location.reload();
        } else {
            location.reload();
        }
    });

    window.ethereum.on('chainChanged', (chainId) => {
        location.reload();
    });
}